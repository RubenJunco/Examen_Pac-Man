<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <canvas id="canvas" width="1000px" height="1000px"></canvas>

    <button id="Pausa">Pausar</button>

    <audio id="Screamer" src="sonido/pausa.mp3"></audio>

    <script>
        const myCanvas = document.getElementById("canvas");
        const ctx = myCanvas.getContext("2d");

        const playerImage = new Image();
        playerImage.src = 'https://upload.wikimedia.org/wikipedia/commons/1/1a/Original_PacMan.svg';

        class Figura {
            constructor(x, y, a, l, color, isImage = false) {
                this.x = x;
                this.y = y;
                this.width = a;
                this.height = l;
                this.color = color;
                this.isImage = isImage;
            }

            draw() {
                if (this.isImage && playerImage.complete) {
                    ctx.drawImage(playerImage, this.x, this.y, this.width, this.height);
                } else {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            }

            isCollidingWith(other) {
                return !(this.x + this.width < other.x ||
                    this.x > other.x + other.width ||
                    this.y + this.height < other.y ||
                    this.y > other.y + other.height);
            }
        }
        //pacman(nombre provicional)
        const itbox = new Figura(700, 350, 30, 30, "red", true);

        // enemigos
        const enemies = [
            new Figura(400, 470, 30, 30, "blue"),
            new Figura(400, 520, 30, 30, "green"),
            new Figura(430, 470, 30, 30, "purple"),
            new Figura(430, 520, 30, 30, "orange")
        ];

        const tp1 = new Figura(430, 0, 140, 30, "blue");
        const tp2 = new Figura(430, 960, 140, 30, "blue");
        const tp3 = new Figura(0, 460, 30, 80, "blue");
        const tp4 = new Figura(970, 460, 30, 80, "blue");

        // Mapa
        const obstaculo = [
            //pared izquierda
            new Figura(0, 0, 30, 450, "Black"),
            new Figura(0, 550, 30, 450, "Black"),

            //linea centro izq.
            new Figura(30, 420, 60, 30, "Black"),
            new Figura(30, 550, 60, 30, "Black"),

            //pared derecha
            new Figura(970, 0, 30, 450, "Black"),
            new Figura(970, 550, 30, 450, "Black"),

            //linea centro der.
            new Figura(910, 420, 60, 30, "Black"),
            new Figura(910, 550, 60, 30, "Black"),

            //techo
            new Figura(0, 0, 400, 30, "Black"),
            new Figura(570, 0, 400, 30, "Black"),
            
            //linea techo centro.
            new Figura(400, 0, 30, 80, "Black"),
            new Figura(570, 0, 30, 80, "Black"),

            //suelo
            new Figura(0, 970, 430, 30, "Black"),
            new Figura(570, 970, 400, 30, "Black"),

            //linea suelo centro.
            new Figura(400, 900, 30, 80, "Black"),
            new Figura(570, 900, 30, 80, "Black"),

            //caja centro
            new Figura(340, 450, 30, 60, "Black"),
            new Figura(620, 450, 30, 60, "Black"),
            new Figura(340, 550, 310, 30, "Black"),
            new Figura(300, 430, 155, 30, "Black"),
            new Figura(540, 430, 155, 30, "Black"),

            //linea derecha ext.
            new Figura(830, 100, 30, 350, "Black"),
            new Figura(640, 100, 190, 30, "Black"),
            new Figura(830, 550, 30, 350, "Black"),
            new Figura(640, 870, 190, 30, "Black"),

            new Figura(900, 70, 30, 300, "Black"),
            new Figura(900, 630, 30, 300, "Black"),
            
            //linea izquierda ext.
            new Figura(140, 100, 30, 350, "Black"),
            new Figura(160, 100, 200, 30, "Black"),
            new Figura(140, 550, 30, 350, "Black"),
            new Figura(160, 870, 200, 30, "Black"),

            new Figura(70, 70, 30, 300, "Black"),
            new Figura(70, 630, 30, 300, "Black"),

            //linea centro abajo
            new Figura(290, 650, 410, 30, "Black"),
            new Figura(485, 670, 30, 80, "Black"),
            new Figura(290, 750, 410, 30, "Black"),

            new Figura(400, 820, 200, 30, "Black"),
            //rayita centro
            new Figura(390, 370, 200, 20, "Black"),
            
            //linea centro arriba
            new Figura(290, 300, 410, 30, "Black"),
            new Figura(485, 220, 30, 80, "Black"),
            new Figura(290, 200, 410, 30, "Black"),

            new Figura(400, 130, 200, 30, "Black"),

            //lineas derechas interiores
            new Figura(210, 180, 30, 280, "Black"),
            new Figura(210, 540, 30, 280, "Black"),

            new Figura(750, 180, 30, 280, "Black"),
            new Figura(750, 540, 30, 280, "Black")
        ];

        let direction = "";
        let speed = 5;
        let isPaused = false;
        const enemySpeed = 3;

        const enemyDirections = ["right", "left", "up", "down"];  

        document.addEventListener("keydown", (event) => {
            switch (event.key) {
                case "w":
                    direction = "up";
                    break;
                case "s":
                    direction = "down";
                    break;
                case "a":
                    direction = "left";
                    break;
                case "d":
                    direction = "right";
                    break;
            }
        });

        function moveEnemy(enemy, index) {
            const previousX = enemy.x;
            const previousY = enemy.y;

            switch (enemyDirections[index]) {
                case "up":
                    enemy.y -= enemySpeed;
                    break;
                case "down":
                    enemy.y += enemySpeed;
                    break;
                case "left":
                    enemy.x -= enemySpeed;
                    break;
                case "right":
                    enemy.x += enemySpeed;
                    break;
            }

            let collided = false;
            obstaculo.forEach(obstacle => {
                if (enemy.isCollidingWith(obstacle)) {
                    collided = true;
                }
            });

            if (collided) {
                enemy.x = previousX;
                enemy.y = previousY;
                enemyDirection(index);
            }

            // Limitar movimiento dentro del canvas
            if (enemy.x < 0 || enemy.x + enemy.width > myCanvas.width || enemy.y < 0 || enemy.y + enemy.height > myCanvas.height) {
                enemy.x = previousX;
                enemy.y = previousY;
                enemyDirection(index);
            }
        }

        function enemyDirection(index) {
            const directions = ["up", "down", "left", "right"];
            enemyDirections[index] = directions[Math.floor(Math.random() * directions.length)];
        }

        function update() {
            if (isPaused) return;

            const previousX = itbox.x;
            const previousY = itbox.y;

            switch (direction) {
                case "up":
                    itbox.y -= speed;
                    break;
                case "down":
                    itbox.y += speed;
                    break;
                case "left":
                    itbox.x -= speed;
                    break;
                case "right":
                    itbox.x += speed;
                    break;
            }

            obstaculo.forEach(obstacle => {
                if (itbox.isCollidingWith(obstacle)) {
                    itbox.x = previousX;
                    itbox.y = previousY;
                }
            });

            if (itbox.isCollidingWith(tp1)) {
                itbox.x = 440;
                itbox.y = 930;
            } else if (itbox.isCollidingWith(tp2)) {
                itbox.x = 450;
                itbox.y = 50;
            } else if (itbox.isCollidingWith(tp3)) {
                itbox.x = 920;
                itbox.y = 460;
            } else if (itbox.isCollidingWith(tp4)) {
                itbox.x = 60;
                itbox.y = 460;
            }

            enemies.forEach((enemy, index) => moveEnemy(enemy, index));
        }

        function paint() {
            ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);

            itbox.draw();
            enemies.forEach(enemy => enemy.draw());
            tp1.draw();
            tp2.draw();
            tp3.draw();
            tp4.draw();

            obstaculo.forEach(obstacle => obstacle.draw());

            update();

            requestAnimationFrame(paint);
        }

        const pauseBtn = document.getElementById("Pausa");
        const Psound = document.getElementById("Screamer");

        pauseBtn.addEventListener("click", () => {
            isPaused = !isPaused;
            pauseBtn.textContent = isPaused ? "Reanudar" : "Pausar";
            Psound.play();
        });

        playerImage.onload = function () {
            paint();
        }

    </script>

    <style type="text/css">
        body {
            background-color: rgb(190, 190, 190);
        }

        #Pausa {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</body>

</html>
